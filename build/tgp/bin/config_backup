#!/sbin/sh
# Config Backup script by djb77

# Mount /data partition
mount /dev/block/platform/155a0000.ufs/by-name/USERDATA /data

# Variables
config=/data/media/0/TGP/config

# Check if TGP folder exists on Internal Memory, if not, it is created
if [ ! -d /data/media/0/TGP ];then
  mkdir /data/media/0/TGP
  chmod 777 /data/media/0/TGP
fi

# Check if config folder exists, if it does, delete it 
if [ -d $config-backup ];then
  rm -rf $config-backup
fi

# Check if config folder exists, if it does, ranme to backup
if [ -d $config ];then
  mv -f $config $config-backup
fi

# Check if config folder exists, if not, it is created
if [ ! -d $config ];then
  mkdir $config
  chmod 777 $config
fi

# Copy files from /tmp/aroma to backup location
cp -f /tmp/aroma/* $config

# Delete any files from backup that are not .prop files
find $config -type f ! -iname "*.prop" -delete

# Remove unwanted .prop files from the backup
cd $config
for delete_prop in *.prop 
do
  if grep "item" "$delete_prop"; then
    rm -f $delete_prop
  fi
  if grep "selected" "$delete_prop"; then
    rm -f $delete_prop
  fi
  if grep "install=0" "$delete_prop"; then
    rm -f $delete_prop
  fi 
done

# Unmount /data Partition
unmount /data
